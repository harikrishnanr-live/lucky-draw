<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Participants - Lucky Draw System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-image: url('background.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    
    /* Professional Loading Spinner */
    .professional-loader {
      display: inline-block;
      position: relative;
      width: 32px;
      height: 32px;
      margin-right: 12px;
    }
    
    .professional-loader div {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #6366f1;
      animation: professional-loader 1.2s linear infinite;
    }
    
    .professional-loader div:nth-child(1) {
      animation-delay: 0s;
      top: 37%;
      left: 66%;
    }
    
    .professional-loader div:nth-child(2) {
      animation-delay: -0.1s;
      top: 22%;
      left: 62%;
    }
    
    .professional-loader div:nth-child(3) {
      animation-delay: -0.2s;
      top: 11%;
      left: 52%;
    }
    
    .professional-loader div:nth-child(4) {
      animation-delay: -0.3s;
      top: 7%;
      left: 40%;
    }
    
    .professional-loader div:nth-child(5) {
      animation-delay: -0.4s;
      top: 11%;
      left: 28%;
    }
    
    .professional-loader div:nth-child(6) {
      animation-delay: -0.5s;
      top: 22%;
      left: 18%;
    }
    
    .professional-loader div:nth-child(7) {
      animation-delay: -0.6s;
      top: 37%;
      left: 14%;
    }
    
    .professional-loader div:nth-child(8) {
      animation-delay: -0.7s;
      top: 52%;
      left: 18%;
    }
    
    .professional-loader div:nth-child(9) {
      animation-delay: -0.8s;
      top: 68%;
      left: 28%;
    }
    
    .professional-loader div:nth-child(10) {
      animation-delay: -0.9s;
      top: 75%;
      left: 40%;
    }
    
    .professional-loader div:nth-child(11) {
      animation-delay: -1.0s;
      top: 68%;
      left: 52%;
    }
    
    .professional-loader div:nth-child(12) {
      animation-delay: -1.1s;
      top: 52%;
      left: 62%;
    }
    
    @keyframes professional-loader {
      0%, 20%, 80%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.5);
        opacity: 0.5;
      }
    }
    
    /* File Upload Animation */
    .file-upload-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .8;
      }
    }
    
    /* Success Animation */
    .success-animation {
      animation: successBounce 0.6s ease-in-out;
    }
    
    @keyframes successBounce {
      0% {
        transform: scale(0.3);
        opacity: 0;
      }
      50% {
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    /* Mobile menu styles */
    .mobile-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
    }
    
    .mobile-menu.active {
      max-height: 300px;
    }
    
    /* Card hover effects */
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Table styling */
    .table-container {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    
    /* Participant row animation */
    .participant-row {
      animation: fadeInUp 0.3s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-gray-900 bg-opacity-90 min-h-screen">

<!-- Navigation -->
<nav class="bg-gradient-to-r from-purple-800 to-indigo-800 text-white py-4 shadow-xl">
  <div class="max-w-7xl mx-auto flex justify-between items-center px-4">
    <a href="dashboard.html" class="text-xl font-bold flex items-center space-x-2">
      <span>🎁</span>
      <span>Lucky Draw System</span>
    </a>
    
    <!-- Desktop Menu -->
    <div class="desktop-menu space-x-6 hidden md:flex">
      <a href="upload-prize.html" class="hover:text-gray-200 transition-colors duration-200 flex items-center space-x-1">
        <span>📋</span>
        <span>Upload Prize</span>
      </a>
      <a href="upload-participants.html" class="font-semibold text-white bg-white bg-opacity-20 px-4 py-2 rounded-lg flex items-center space-x-1">
        <span>👥</span>
        <span>Upload Participants</span>
      </a>
      <a href="lucky-draw.html" class="hover:text-gray-200 transition-colors duration-200 flex items-center space-x-1">
        <span>🎲</span>
        <span>Lucky Draw</span>
      </a>
      <a href="winners.html" class="hover:text-gray-200 transition-colors duration-200 flex items-center space-x-1">
        <span>🏆</span>
        <span>Winners</span>
      </a>
      <button id="navLogout" class="px-4 py-2 bg-white text-indigo-700 rounded-lg hover:bg-indigo-100 text-sm transition-colors duration-200 font-semibold">
        Logout
      </button>
    </div>
    
    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn" class="md:hidden focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>
  
  <!-- Mobile Menu -->
  <div id="mobileMenu" class="mobile-menu md:hidden bg-purple-900 bg-opacity-90 px-4 pb-4">
    <div class="flex flex-col space-y-3 mt-4">
      <a href="upload-prize.html" class="hover:text-gray-200 py-2 transition-colors duration-200">📋 Upload Prize</a>
      <a href="upload-participants.html" class="font-semibold text-white bg-white bg-opacity-20 px-3 py-2 rounded-lg">👥 Upload Participants</a>
      <a href="lucky-draw.html" class="hover:text-gray-200 py-2 transition-colors duration-200">🎲 Lucky Draw</a>
      <a href="winners.html" class="hover:text-gray-200 py-2 transition-colors duration-200">🏆 Winners</a>
      <button id="mobileLogout" class="px-3 py-2 bg-white text-indigo-700 rounded-lg hover:bg-indigo-100 text-sm transition-colors duration-200 text-left font-semibold">
        Logout
      </button>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="max-w-4xl mx-auto mt-8 px-4">
  <!-- Page Header -->
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-white mb-2">👥 Upload Participants</h1>
    <p class="text-gray-300">Upload your Excel file containing participant codes</p>
  </div>

  <!-- Upload Card -->
  <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-xl shadow-2xl p-8 mb-8 card-hover">
    <div class="mb-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">📤 Participant File Upload</h2>
      <p class="text-gray-600 text-sm">Upload an .xlsx file with participant codes in the first column</p>
    </div>

    <div id="dropzone" class="mb-6 rounded-lg border-2 border-dashed border-purple-400 bg-gradient-to-br from-purple-50 to-indigo-50 p-12 text-center text-gray-600 transition-all duration-300 ease-in-out hover:shadow-lg hover:from-purple-100 hover:to-indigo-100 cursor-pointer card-hover">
      <div class="flex flex-col items-center space-y-4">
        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center">
          <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <div>
          <p class="text-lg font-medium text-gray-700 mb-1">Drop your participants file here</p>
          <p class="text-sm text-gray-500">or click to browse and select file</p>
        </div>
        <div class="flex items-center space-x-2 text-xs text-gray-400">
          <span>Supported format:</span>
          <span class="bg-green-100 text-green-700 px-2 py-1 rounded">.xlsx</span>
        </div>
      </div>
      <input type="file" id="excelInput" class="hidden" accept=".xlsx" />
    </div>

    <!-- Status Messages -->
    <div id="result" class="mb-4"></div>
  </div>

  <!-- Participants Table -->
  <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-xl shadow-2xl overflow-hidden table-container">
    <div class="px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
      <h3 class="text-lg font-semibold flex items-center">
        <span class="mr-2">👥</span>
        Participant Codes
        <span id="participantCount" class="ml-auto text-sm bg-white bg-opacity-20 px-2 py-1 rounded-full">0 participants</span>
      </h3>
    </div>
    
    <div class="max-h-96 overflow-y-auto">
      <table id="participantTable" class="hidden min-w-full">
        <thead class="bg-gray-50 sticky top-0">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Participant Code</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200"></tbody>
      </table>
      
      <div id="emptyState" class="p-8 text-center text-gray-500">
        <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <p class="text-sm">No participants uploaded yet. Upload an Excel file to get started.</p>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("excelInput");
    const logoutBtn = document.getElementById("navLogout");
    const mobileLogoutBtn = document.getElementById("mobileLogout");
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    // Mobile menu toggle
    mobileMenuBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("active");
    });

    // Dropzone interactions
    dropzone.addEventListener("click", () => fileInput.click());

    dropzone.addEventListener("dragover", e => {
      e.preventDefault();
      dropzone.classList.add("file-upload-animation");
      dropzone.style.borderColor = "#9333ea";
      dropzone.style.backgroundColor = "rgba(147, 51, 234, 0.1)";
    });

    dropzone.addEventListener("dragleave", () => {
      dropzone.classList.remove("file-upload-animation");
      dropzone.style.borderColor = "";
      dropzone.style.backgroundColor = "";
    });

    dropzone.addEventListener("drop", e => {
      e.preventDefault();
      dropzone.classList.remove("file-upload-animation");
      dropzone.style.borderColor = "";
      dropzone.style.backgroundColor = "";
      handleFile(e.dataTransfer.files[0]);
    });

    fileInput.addEventListener("change", function () {
      handleFile(this.files[0]);
    });

    // Logout functionality
    const handleLogout = () => {
      localStorage.clear();
      sessionStorage.clear();
      window.location.href = "index.html";
    };

    logoutBtn.addEventListener("click", handleLogout);
    mobileLogoutBtn.addEventListener("click", handleLogout);

    // Load existing participants on page load
    const stored = JSON.parse(localStorage.getItem("participants") || "[]");
    if (stored.length) {
      renderParticipants(stored);
      showMessage("success", `✅ Loaded ${stored.length} participants from storage.`);
    }
  });

  function handleFile(file) {
    if (!file || !file.name.endsWith(".xlsx")) {
      showMessage("error", "❌ Please upload a valid .xlsx file.");
      return;
    }

    showMessage("loading", "Processing participant file...");
    
    // Clear previous data from localStorage
    localStorage.removeItem("participants");

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        const participants = rows
          .filter(row => row[0] && row[0].toString().trim() !== "")
          .map(row => row[0].toString().trim());

        if (participants.length === 0) {
          showMessage("warning", "⚠️ No valid participant codes found. Please check your file format.");
          return;
        }

        // Store in localStorage
        localStorage.setItem("participants", JSON.stringify(participants));
        renderParticipants(participants);
        showMessage("success", `✅ Successfully uploaded ${participants.length} participants!`);
      } catch (error) {
        console.error("Parsing error:", error);
        showMessage("error", "❌ Failed to parse file. Please check the format and try again.");
      }
    };

    reader.readAsArrayBuffer(file);
  }

  function showMessage(type, message) {
    const result = document.getElementById("result");
    let className = "";
    let icon = "";

    switch (type) {
      case "success":
        className = "bg-green-100 border border-green-400 text-green-700 success-animation";
        icon = "✅";
        break;
      case "error":
        className = "bg-red-100 border border-red-400 text-red-700";
        icon = "❌";
        break;
      case "warning":
        className = "bg-yellow-100 border border-yellow-400 text-yellow-700";
        icon = "⚠️";
        break;
      case "loading":
        className = "bg-blue-100 border border-blue-400 text-blue-700";
        icon = '<div class="professional-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';
        break;
    }

    result.innerHTML = `
      <div class="px-4 py-3 rounded-lg ${className} flex items-center">
        <span class="mr-3">${icon}</span>
        <span class="font-medium">${message}</span>
      </div>
    `;
  }

  function renderParticipants(participants) {
    const table = document.getElementById("participantTable");
    const tbody = table.querySelector("tbody");
    const emptyState = document.getElementById("emptyState");
    const participantCount = document.getElementById("participantCount");

    if (participants.length === 0) {
      table.classList.add("hidden");
      emptyState.classList.remove("hidden");
      participantCount.textContent = "0 participants";
      return;
    }

    tbody.innerHTML = participants.map((code, index) => `
      <tr class="hover:bg-gray-50 transition-colors duration-200 participant-row" style="animation-delay: ${index * 0.05}s">
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center">
            <div class="flex-shrink-0 h-8 w-8 bg-purple-100 rounded-full flex items-center justify-center">
              <span class="text-purple-600 font-medium text-sm">${index + 1}</span>
            </div>
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm font-medium text-gray-900">${code}</div>
        </td>
      </tr>
    `).join("");

    table.classList.remove("hidden");
    emptyState.classList.add("hidden");
    participantCount.textContent = `${participants.length} participant${participants.length === 1 ? '' : 's'}`;
  }
</script>
</body>
</html>